# Money - 超简单iOS记账App

智能记账应用，支持OCR图像识别、iOS快捷指令集成。

## 项目概览

这是一个专为初学者设计的iOS记账应用，采用SwiftUI + Core Data架构，具备以下特色：

- 📱 简洁的用户界面设计
- 🧠 OCR智能图像识别功能 
- 📷 相机/相册图片选择功能
- 🔗 iOS Shortcuts快捷指令集成
- 🔐 智能权限管理系统 ✨
- 📊 实时支出统计分析
- 🗂️ 完整的记录管理系统

## 开发状态

### ✅ Phase 1 已完成 (天数: 4天)
- **基础架构搭建**: SwiftUI + Core Data + MVVM
- **数据模型设计**: 支出/分类/账户三大核心模型
- **基础界面开发**: 主界面、添加支出界面
- **核心功能实现**: 记录增删、实时统计显示

### ✅ Phase 2 已完成 (天数: 1天)
- **OCR图像识别**: 使用Vision框架实现文字识别
- **智能文本解析**: 从识别文本中提取金额、商家、分类等信息
- **支出列表界面**: 完整的记录管理功能
- **代码优化**: 修复编译错误，确保项目稳定运行

### ✅ Phase 3 已完成 (天数: 2天) 
- **OCR界面集成**: 在添加支出界面完整集成OCR功能 ✨
- **图片选择器**: 实现相机和相册选择功能 ✨
- **iOS Shortcuts集成**: 开发快捷指令支持，支持URL Scheme调用 ✨
- **权限管理系统**: 完整的照片权限管理和用户引导 🔐
- **金额识别优化**: 支持负数金额(-32.40)、支付宝/微信等支付应用格式 🚀
- **商家识别增强**: 智能识别"美团"、"小象超市"等平台商家名称 🚀
- **分类推断优化**: 新增外卖平台、电商平台等现代消费场景分类 🚀
- **时间格式过滤**: 完美解决"17:04"等时间格式被误识别为金额的问题 🔥
- **智能文本检测**: 新增纯时间格式文本预检测，提升识别准确性 🔥
- **URL编码测试**: 完整的文本编码传输验证系统 🧪
- **项目编译**: 成功解决所有编译错误，确保功能稳定

### ✅ Phase 4 已完成 (天数: 1天) - 权限配置优化 🔧
- **权限问题诊断**: 深入分析iOS 14+权限机制变化
- **Info.plist优化**: 添加关键配置`PHPhotoLibraryRequestedAuthorizationLevel`
- **权限管理重构**: 优化PermissionManager权限请求逻辑
- **编译错误修复**: 解决权限代码中的Swift编译问题
- **完全访问支持**: 确保用户能在设置中看到"完全访问"选项 ✅
- **权限测试文档**: 创建详细的权限测试和验证指南
- **代码健壮性**: 提升权限处理的稳定性和用户体验

### 📋 Phase 5 计划中 (预计: 2天)
- **统计图表**: 支出趋势可视化
- **数据分析**: 深入的支出洞察
- **功能测试**: 完整的功能验证

### 🔧 Phase 6 计划中 (预计: 1天)
- **最终测试**: 完整功能测试
- **性能优化**: 代码重构和性能提升

---

## 🔐 权限管理系统 (Phase 3 新增)

### 照片权限重要性
为了实现最佳的OCR识别体验，建议将照片权限设置为**完全访问**：

#### 私密访问 vs 完全访问
| 权限类型 | 功能 | OCR体验 | 快捷指令支持 |
|---------|------|---------|-------------|
| **私密访问** | ✅ 选择特定照片<br>✅ 相机拍照 | ⚠️ 需手动选择截图<br>❌ 无法自动获取最新截图 | ❌ 快捷指令无法自动传递截图 |
| **完全访问** | ✅ 访问所有照片<br>✅ 自动获取最新截图 | ✅ 最佳OCR体验<br>✅ 快捷指令完美协作 | ✅ 自动化记账流程 |

### 权限设置方法

#### 方法1: 系统设置 ⭐️ **推荐**
1. 打开iPhone **设置**
2. 向下滚动找到 **"Money"** 应用
3. 点击进入Money应用设置
4. 点击 **"照片"** 权限
5. 选择 **"完全访问"**

#### 方法2: 应用内设置
1. 打开Money应用
2. 尝试使用OCR功能
3. 当提示权限时，选择 **"允许访问所有照片"**

### 智能权限检测
应用启动时会自动检测权限状态并提供建议：

```
📸 检查所有权限状态...
============================================================
📷 照片库权限: 私密访问
💡 建议: 建议设置为"完全访问"以获得更好的OCR体验
⚠️  当前为私密访问，可能影响OCR功能
💡 建议设置为完全访问以获得最佳体验
============================================================
```

---

## 最新技术突破 🚀

### 🧪 URL编码验证系统 (v3.0)
- **自动化测试**: 14种编码场景的全自动测试
- **中文字符**: 完美支持"滴滴出行"等中文商家名
- **特殊符号**: 支持¥、€、$等货币符号编码
- **复杂格式**: 验证时间格式、负数金额等复杂场景
- **实时验证**: 应用启动时自动运行编码测试

### 智能金额识别 (v2.0)
- **负数支持**: 完美识别支付宝账单中的"-32.40"格式
- **多种货币格式**: 支持¥、元、块等各种货币符号
- **支付应用优化**: 专门针对支付宝、微信支付界面优化
- **智能过滤**: 自动排除时间格式(15:04)、日期等干扰数字

### 商家识别升级 (v2.0) 
- **平台商家**: 智能识别"美团"、"饿了么"、"淘宝"等平台
- **复杂格式**: 支持"小象超市（原美团买菜-葛庄店）"等复杂商家名
- **关键词匹配**: 基于商家类型关键词的智能匹配
- **中文优化**: 完整支持中文商家名称识别

### 分类推断智能化 (v2.0)
- **现代消费场景**: 新增外卖、电商、网约车等分类
- **品牌识别**: 支持麦当劳、星巴克、滴滴等知名品牌自动分类
- **生活服务**: 新增美容、维修、快递等生活服务分类
- **智能匹配**: 基于商家名称和关键词的双重匹配机制

## 技术架构

### 核心技术栈
- **前端**: SwiftUI (iOS 18.2+)
- **数据层**: Core Data
- **图像识别**: Vision Framework + OCR
- **快捷指令**: iOS Shortcuts Integration
- **权限管理**: Photos Framework + 智能检测 🔐
- **架构模式**: MVVM + 单例模式

### 项目结构
```
Money/
├── Models (数据模型)
│   ├── Expense.swift          # 支出记录模型
│   ├── Category.swift         # 分类模型
│   └── Account.swift          # 账户模型
├── Services (业务服务)
│   ├── DataManager.swift      # 数据管理服务
│   ├── OCRService.swift       # OCR识别服务 ✨
│   ├── TextParsingService.swift # 智能文本解析服务 🚀 (v2.0)
│   ├── URLStateManager.swift  # URL状态管理服务 ✨
│   ├── ShortcutsService.swift # 快捷指令服务 ✨
│   ├── PermissionManager.swift # 权限管理服务 🔐 (v3.0)
│   └── URLEncodingTestHelper.swift # URL编码测试服务 🧪 (v3.0)
├── Views (界面视图)
│   ├── ContentView.swift      # 主界面
│   ├── AddExpenseView.swift   # 添加支出界面 (含OCR) ✨
│   └── ExpenseListView.swift  # 支出列表界面
├── Intents (快捷指令)
│   └── AddExpenseIntent.swift # 快捷指令Intent ✨
└── Core Data
    └── Money.xcdatamodeld     # 数据模型定义
```

### PermissionManager v3.0 核心功能 🔐

#### 权限状态检测
```swift
// 支持的权限状态
.notDetermined    // 未确定
.restricted       // 受限制  
.denied          // 已拒绝
.limited         // 私密访问 ⚠️
.authorized      // 完全访问 ✅
```

#### 智能权限建议
```swift
// 根据权限状态提供建议
switch photoLibraryStatus {
case .limited:
    return "建议设置为\"完全访问\"以获得更好的OCR体验"
case .authorized:
    return "照片权限已正确配置"
case .denied:
    return "请在设置中开启照片访问权限"
}
```

#### 权限管理功能
- **自动检测**: 应用启动时自动检测权限状态
- **智能建议**: 根据当前权限提供优化建议
- **一键设置**: 直接跳转到系统设置页面
- **权限升级**: 支持从私密访问升级到完全访问

### URLEncodingTestHelper v3.0 测试系统 🧪

#### 全面测试场景
```swift
// 14种测试场景
"滴滴出行 -12.40"           // 中文+负数
"¥123.45"                 // 货币符号
"17:454"                  // 时间格式误识别
"美团外卖&星巴克 ¥45.60"    // 复杂混合内容
```

#### 编码验证算法
```swift
// 多种编码方式验证
.urlQueryAllowed          // URL查询参数编码
.urlPathAllowed           // URL路径编码  
.urlFragmentAllowed       // URL片段编码
.urlHostAllowed           // URL主机编码
```

### TextParsingService v2.0 核心算法 🧠

#### 时间格式检测算法 🔥
```swift
// 预检测时间格式，避免误识别
"^\\d{1,2}:\\d{2}$"                    // HH:MM 格式 (如 17:04)
"^\\d{1,2}:\\d{2}:\\d{2}$"             // HH:MM:SS 格式
"^\\d{4}-\\d{2}-\\d{2}$"               // YYYY-MM-DD 格式
"^\\d{4}年\\d{1,2}月\\d{1,2}日$"        // 中文日期格式
```

#### 金额提取算法
```swift
// 支持的金额格式
"-¥32.40"           // 支付宝格式
"¥-32.40"           // 变体格式  
"-32.40元"          // 中文格式
"交易成功 -32.40"    // 支付应用格式
"美团 -32.40"       // 平台格式
```

#### 商家识别算法
```swift
// 智能模式匹配
"([中文字符]{2,10})\\s*-?\\d+\\.\\d{2}"    // 商家名+金额
"([中文字符]{2,15})(?:\\s*\\(.*?\\))?\\s*-?\\d+\\.\\d{2}" // 复杂商家名
```

#### 分类推断算法
```swift
// 现代消费场景映射
"餐饮": ["美团", "饿了么", "外卖", "麦当劳", "星巴克"]
"交通": ["滴滴", "网约车", "共享单车", "摩拜"]  
"购物": ["淘宝", "京东", "拼多多", "天猫"]
```

### Phase 3 功能详解

#### 1. OCR界面集成 📷
- **完整功能**: 在添加支出界面内置OCR识别
- **图像预处理**: 自动优化图像质量提高识别准确度
- **实时结果显示**: 识别结果即时展示，支持手动调整
- **智能填充**: 自动将识别结果填入相应字段

#### 2. 图片选择器 📱
- **双源支持**: 相机拍照 + 相册选择
- **PhotosUI集成**: 使用最新的PhotosUI框架
- **权限管理**: 完善的相机和相册访问权限处理
- **图像格式**: 支持多种图像格式的选择和处理

#### 3. iOS快捷指令集成 🔗
- **Intent结构**: 完整的AddExpenseIntent实现
- **快捷指令服务**: ShortcutsService统一管理
- **URL Scheme**: 支持`money://add-expense`外部调用
- **参数传递**: 支持金额、分类、账户等参数传递
- **用户确认界面**: 快捷指令调用显示确认界面而非直接保存

#### 4. 权限管理系统 🔐
- **智能检测**: 自动检测照片权限状态
- **用户引导**: 清晰的权限设置指导
- **权限优化**: 建议用户设置完全访问权限
- **系统集成**: 直接跳转到系统设置页面

### 🛠️ 技术特点

- **正则表达式优化**: 更精确的模式匹配
- **智能过滤**: 自动排除时间格式等干扰数字
- **时间格式检测**: 专门识别"17:04"、"HH:MM"等时间格式，避免误识别 🔥
- **预检测机制**: 在解析前检测纯时间格式文本，直接返回失败结果 🔥
- **URL编码验证**: 全自动化的文本编码传输测试 🧪
- **权限智能管理**: 自动检测并优化权限配置 🔐
- **调试信息**: 完整的日志输出便于问题排查
- **容错性**: 多种候选方案确保识别成功率

### 使用指南

#### 基础功能
1. **添加支出**: 点击主界面的"+"按钮
2. **OCR识别**: 在添加支出界面选择相机或相册
3. **查看记录**: 点击"查看全部"进入支出列表
4. **快捷指令**: 在快捷指令App中添加记账动作

#### OCR功能使用
1. 进入添加支出界面
2. 点击"OCR识别"按钮
3. 选择拍照或从相册选择
4. 等待识别完成
5. 确认并调整识别结果
6. 保存支出记录

#### 权限优化设置 🔐
1. **检查权限状态**: 应用启动时查看权限提示
2. **设置完全访问**: 
   - 方法1: 设置 → Money → 照片 → 完全访问
   - 方法2: 应用内权限提示时选择"允许访问所有照片"
3. **验证设置**: 重启应用查看权限状态

#### 快捷指令设置
1. 打开快捷指令App
2. 添加"记账"动作
3. 配置金额、分类等参数
4. 保存并使用

### 开发亮点

- ✅ **零编译错误**: 所有代码模块完美集成
- ✅ **中文注释**: 代码可读性极佳
- ✅ **错误处理**: 完善的异常处理机制
- ✅ **权限管理**: 智能权限检测和用户引导 🔐
- ✅ **编码验证**: 全自动化URL编码测试系统 🧪
- ✅ **用户体验**: 流畅的操作体验

### 下一步规划

- **Phase 4**: 统计图表和数据分析功能
- **Phase 5**: 最终测试和性能优化
- **目标**: 打造完整的智能记账解决方案

---

*此项目完美适合初学者学习iOS开发，代码结构清晰，注释详细，功能实用。* 🎯

## 数据模型

### 支出记录 (Expense)
```swift
- amount: Double          # 金额
- note: String?          # 备注  
- date: Date             # 日期
- category: Category     # 分类
- account: Account       # 账户
- imageData: Data?       # 相关图片 ✨
- ocrText: String?       # OCR识别文本 ✨
```

### 分类 (Category)
```swift
- name: String           # 分类名称
- icon: String           # 图标名称
- color: String          # 颜色
```

### 账户 (Account)  
```swift
- name: String           # 账户名称
- accountType: AccountType # 账户类型
```

## 默认数据

### 预设分类 (10个)
🍽️ 餐饮 | 🚗 交通 | 🛍️ 购物 | 🎮 娱乐 | 🏥 医疗  
📚 教育 | 🏠 居住 | 👕 服饰 | 💻 数码 | 📦 其他

### 预设账户 (5个)  
💰 现金 | 🏦 银行卡 | 💳 信用卡 | 💙 支付宝 | 💚 微信

## 核心特性

### 智能识别能力 ✨
- **高精度OCR**: 基于Vision框架的文字识别
- **智能解析**: 自动提取金额、商家、分类信息
- **多格式支持**: 支持各种票据和截图格式
- **中英双语**: 完整支持中文和英文识别

### 用户体验优化
- **简洁界面**: 遵循iOS设计规范
- **快速记录**: 一键添加支出记录
- **实时统计**: 今日/本月支出实时显示
- **智能分类**: AI辅助分类推荐

### 数据管理
- **本地存储**: Core Data确保数据安全
- **完整备份**: 支持数据的完整性
- **快速搜索**: 高效的搜索和筛选功能

## 编译和运行

### 系统要求
- Xcode 15.0+
- iOS 18.2+
- macOS 14.0+

### 编译步骤
1. 克隆项目到本地
2. 使用Xcode打开 `Money.xcodeproj`
3. 选择目标设备 (iPhone模拟器)
4. 点击运行按钮 (⌘+R)

### 编译状态
✅ **编译成功** - 项目可正常运行
✅ **无错误** - 所有语法和类型检查通过
✅ **功能完整** - Phase 1 & 2 所有功能可用

## 开发日志

### 2024年 - Phase 2 完成
- ✅ 实现OCR图像识别服务
- ✅ 开发智能文本解析算法
- ✅ 创建完整的支出列表界面
- ✅ 修复所有编译错误
- ✅ 优化代码结构和注释

### 下一步计划
1. **OCR界面集成**: 将OCR功能完整集成到添加支出界面
2. **图片选择器**: 实现相机和相册选择功能
3. **iOS Shortcuts**: 开发快捷指令集成
4. **数据可视化**: 添加图表和统计功能

---

## 设计理念

这个项目是专门为不懂代码的用户设计的记账应用，通过AI和OCR技术让记账变得更加简单高效。我们遵循以下设计原则：

1. **简单易用**: 界面简洁，操作直观
2. **智能识别**: AI辅助用户快速记录
3. **功能完整**: 提供完整的记账功能
4. **性能优秀**: 响应迅速，体验流畅

期待您的使用和反馈！🎉

## 🎯 项目目标

开发一款iOS平台的极简记账工具，通过快捷方式快速唤起，支持截屏识别和自动记账功能。让记账变得像拍照一样简单！

## 📱 核心功能

### 1. 快捷方式集成
- **iOS快捷方式支持**：通过Siri快捷方式快速启动记账功能
- **后台快速启动**：无需打开主应用，直接执行记账流程
- **语音唤起**：支持"Hey Siri，记账"等语音指令

### 2. 智能截屏识别
- **自动截屏**：调用系统截屏功能
- **OCR文字识别**：识别截屏中的文字信息
- **智能解析**：自动提取金额、商家、时间等关键信息
- **支持场景**：
  - 支付宝/微信支付截图
  - 银行短信截图
  - 购物小票拍照
  - 转账记录截图

### 3. 自动记账
- **智能分类**：根据识别内容自动分类（餐饮、交通、购物等）
- **商家识别**：自动识别常见商家名称
- **金额提取**：精确提取交易金额
- **时间记录**：自动记录交易时间
- **备注生成**：根据识别内容生成合适的备注

### 4. 数据管理
- **本地存储**：使用Core Data本地存储，保护隐私
- **账本管理**：支持多个账本（个人、家庭、公司等）
- **账户管理**：支持不同支付方式（现金、信用卡、支付宝等）
- **标签系统**：灵活的标签管理

## 🛠 技术方案

### 开发框架
- **Swift + SwiftUI**：现代化的iOS开发框架
- **Core Data**：本地数据存储
- **Vision Framework**：图像识别和OCR
- **Intents Framework**：快捷方式集成
- **PhotosUI**：图片选择和处理

### 架构设计
```
Money App
├── Views (界面层)
│   ├── ContentView.swift (主界面) ✅
│   ├── AddExpenseView.swift (添加支出) ✅
│   ├── ExpenseListView.swift (支出列表)
│   └── SettingsView.swift (设置)
├── Models (数据模型)
│   ├── Expense.swift (支出模型) ✅
│   ├── Category.swift (分类模型) ✅
│   └── Account.swift (账户模型) ✅
├── Services (业务逻辑)
│   ├── OCRService.swift (OCR识别服务)
│   ├── DataManager.swift (数据管理) ✅
│   └── IntentHandler.swift (快捷方式处理)
└── Extensions (扩展工具)
    ├── Date+Extension.swift
    └── String+Extension.swift
```

## 📋 开发计划

### Phase 1: 基础框架搭建 ✅ **已完成** (第1-2天)
- [x] 创建SwiftUI项目结构
- [x] 设计数据模型 (Expense, Category, Account)
- [x] 集成Core Data
- [x] 创建基础UI界面
- [x] 实现数据管理器
- [x] 完成主界面和添加支出界面

### Phase 2: 核心功能开发 (第3-5天)
- [ ] 实现OCR图像识别功能
- [ ] 开发智能文本解析算法
- [ ] 完善添加支出界面
- [ ] 实现支出列表和搜索功能

### Phase 3: 快捷方式集成 (第6-7天)
- [ ] 创建Intents扩展
- [ ] 实现快捷方式处理逻辑
- [ ] 集成系统截屏功能
- [ ] 测试快捷方式流程

### Phase 4: 优化和测试 (第8-9天)
- [ ] UI/UX优化
- [ ] 性能优化
- [ ] 错误处理完善
- [ ] 全面测试

### Phase 5: 发布准备 (第10天)
- [ ] App Store配置
- [ ] 用户说明文档
- [ ] 最终测试和bug修复

## 🎨 界面设计

### 主界面功能 ✅
- **快速添加按钮**：大号的"+"按钮，支持多种添加方式
- **最近记录**：显示最近的几笔支出
- **统计卡片**：今日/本月支出统计
- **快捷分类**：常用分类快速选择

### 添加支出界面 ✅
- **金额输入**：大号数字键盘
- **分类选择**：图标+文字的分类选择
- **账户选择**：支付方式选择
- **备注输入**：可选的备注信息
- **照片识别**：支持拍照或选择图片识别

## 📱 使用方法

### 快捷方式使用
1. **设置快捷方式**
   - 打开"快捷指令"app
   - 搜索"Money记账"
   - 添加到主屏幕或Siri

2. **语音记账**
   - 说"Hey Siri，记账"
   - 系统自动截屏并识别
   - 确认信息后自动保存

3. **手动记账**
   - 点击快捷方式图标
   - 选择拍照或从相册选择
   - 系统自动识别并填充信息

### 数据管理
- **查看记录**：在主界面查看所有支出记录
- **编辑记录**：长按记录可编辑或删除
- **导出数据**：支持导出CSV格式数据
- **备份恢复**：iCloud自动备份

## 🔧 技术细节

### OCR识别优化
- **预处理**：图像增强、去噪、角度矫正
- **关键词匹配**：预设常见商家和消费场景关键词
- **正则表达式**：精确提取金额、时间等结构化信息
- **机器学习**：基于用户使用习惯优化识别准确率

### 性能优化
- **异步处理**：OCR识别在后台线程执行
- **缓存机制**：识别结果和图片缓存
- **内存管理**：及时释放大图片内存
- **电池优化**：避免频繁的CPU密集型操作

### 隐私保护
- **本地处理**：所有数据处理在本地完成
- **无网络传输**：不上传任何个人信息
- **权限最小化**：只请求必要的系统权限
- **数据加密**：敏感数据本地加密存储

## 🎉 当前项目状态

### ✅ 已完成功能
1. **项目基础架构**
   - SwiftUI + CoreData 技术栈搭建完成
   - 数据模型设计完成（Expense、Category、Account）
   - 数据管理器实现完成

2. **界面开发**
   - 主界面：统计卡片、快速添加按钮、最近记录列表
   - 添加支出界面：金额输入、分类选择、账户选择
   - 美观的UI设计，支持深色模式

3. **数据功能**
   - 支出记录的增删查改
   - 预设10种常用分类（餐饮、交通、购物等）
   - 预设5种支付方式（现金、银行卡、信用卡、支付宝、微信）
   - 今日/本月消费统计

4. **编译状态**
   - ✅ 项目编译成功
   - ✅ 无编译错误
   - ✅ 代码结构清晰，注释完善

### 🔄 下一步计划
1. **OCR功能开发**：集成Vision Framework实现图像识别
2. **智能解析**：开发文本解析算法，提取金额、商家等信息
3. **支出列表**：完善支出记录列表界面
4. **快捷方式集成**：实现iOS快捷指令支持

## 🐛 已知问题和改进计划

### 当前版本问题
- OCR识别功能待开发
- 快捷方式集成待实现
- 需要更多的测试数据验证

### 改进计划
- 增加更多支付场景的识别支持
- 优化UI/UX设计
- 增加数据统计和分析功能
- 支持多人共享账本

## 📞 支持和反馈

如有问题或建议，请及时反馈以便我们持续改进这个工具！

---
**最后更新时间**: 2025年6月14日  
**项目状态**: Phase 1 已完成，进入Phase 2开发  
**开发者**: 您的专属产品经理和工程师 

## 最新优化（Phase 3）

### 🎯 OCR识别问题修复
我们解决了用户反馈的OCR识别不准确问题：

#### 问题分析
- **原始问题**: 滴滴出行账单截图中的 `-12.40` 金额和 `滴滴出行` 商家信息未被正确识别
- **根本原因**: OCR识别结果为 `17:454`，说明问题出现在OCR识别阶段，而非数据传递阶段

#### 解决方案
1. **增强OCR调试**: 添加详细的OCR识别日志，包括图片信息、识别过程和结果
2. **优化文本解析**: 
   - 添加滴滴出行等交通应用的特殊识别模式
   - 支持负数金额识别（-12.40、-¥32.40、¥-12.40等）
   - 增强时间格式过滤，避免误识别
3. **商家识别增强**: 
   - 支持 `滴滴出行`、`特惠快车` 等交通相关关键词
   - 优化商家名称提取算法

### 📊 识别能力对比

#### 优化前
- ❌ 时间格式误识别: `17:04` → `17.0`
- ❌ 负数不支持: `-12.40` 无法识别
- ❌ 交通应用支持差: 滴滴出行等识别率低

#### 优化后
- ✅ 时间格式过滤: `17:04` 正确排除
- ✅ 负数完全支持: `-12.40`、`-¥32.40`、`¥-12.40` 等
- ✅ 交通应用优化: 滴滴出行、特惠快车等专门优化
- ✅ 调试信息完善: 详细的OCR→解析→UI数据流日志

### 🔧 技术改进
- **正则表达式优化**: 修复Swift Regex API兼容性问题
- **错误处理增强**: 添加置信度检查和降级处理
- **权限配置**: 完善相机和相册访问权限
- **性能优化**: 优化文本解析算法性能

## 快捷指令配置

### 方式一：简单文本传递
```
打开URL: money://add-expense?text=测试金额32.40
```

### 方式二：OCR截图识别（推荐）
1. **截取屏幕** - 选择"截取屏幕"操作
2. **从图像中获取文本** - 添加OCR文本提取
3. **打开URL** - 设置URL为 `money://add-expense?text=[图像中的文本]&note=截图自动识别`

### 配置建议
- **快捷指令名称**: "记账助手" 或 "智能记账"
- **Siri短语**: "帮我记账" 或 "添加支出"
- **图标**: 选择财务相关图标
- **隐私设置**: 允许在锁定屏幕上运行

## OCR故障排除

### 常见问题
1. **识别结果为空**
   - 检查图片清晰度
   - 确保文字对比度足够
   - 查看控制台OCR调试日志

2. **金额识别错误**
   - 确保金额数字清晰可见
   - 检查是否有特殊符号干扰
   - 查看解析日志中的候选金额

3. **商家识别失败**
   - 检查商家名称是否包含关键词
   - 查看是否被排除词汇过滤
   - 考虑手动添加商家关键词

### 调试信息
应用会输出详细的调试日志：
- 📷 OCR图片信息和识别结果
- 🔍 文本解析过程和候选项
- 💰 金额提取的各个步骤
- 🏪 商家识别的匹配过程
- 📝 最终数据传递结果

## 技术架构

### 核心服务
- **DataManager**: Core Data数据管理
- **OCRService**: 图像文字识别服务
- **TextParsingService**: 智能文本解析服务
- **URLStateManager**: URL状态管理
- **ShortcutsService**: 快捷指令支持

### 数据模型
- **Expense**: 支出记录模型
- **Category**: 分类模型
- **Account**: 账户模型

### 界面组件
- **ContentView**: 主界面
- **AddExpenseView**: 添加支出界面
- **ExpenseListView**: 支出列表界面

## 开发环境
- **Xcode**: 16.0+
- **iOS**: 18.2+
- **Swift**: 5.0+
- **框架**: SwiftUI, Core Data, Vision

## 安装和运行
1. 克隆项目到本地
2. 使用Xcode打开 `Money.xcodeproj`
3. 选择目标设备或模拟器
4. 按 `Cmd+R` 运行项目

## 贡献指南
欢迎提交Issue和Pull Request来改进这个项目。

## 许可证
本项目采用MIT许可证。